# Question 754
## Question
* A company has users all around the world accessing its HTTP-based application deployed on Amazon EC2 instances in multiple AWS Regions. The company wants to *improve the availability and performance of the application*. The company also wants to *protect the application against common web exploits* that may affect availability, compromise security, or consume excessive resources. Static IP addresses are required.
* What should a solutions architect recommend to accomplish this?


## Options
* A. Put the EC2 instances behind *Network Load Balancers* (NLBs) in each Region. Deploy *AWS WAF* on the NLBs. Create an accelerator using *AWS Global Accelerator* and register the NLBs as endpoints.
* B. Put the EC2 instances behind *Application Load Balancers* (ALBs) in each Region. Deploy *AWS WAF* on the ALBs. Create an accelerator using *AWS Global Accelerator* and register the ALBs as endpoints.
* C. Put the EC2 instances behind Network Load Balancers (NLBs) in each Region. Deploy AWS WAF on the NLBs. Create an Amazon CloudFront distribution with an origin that uses Amazon Route 53 latency-based routing to route requests to the NLBs.
* D. Put the EC2 instances behind Application Load Balancers (ALBs) in each Region. Create an Amazon CloudFront distribution with an origin that uses Amazon Route 53 latency-based routing to route requests to the ALBs. Deploy AWS WAF on the CloudFront distribution.


## Answer
* * B. Put the EC2 instances behind *Application Load Balancers* (ALBs) in each Region. Deploy *AWS WAF* on the ALBs. Create an accelerator using *AWS Global Accelerator* and register the ALBs as endpoints.


## Explanation
* Requirements:
  * **Improve availability and performance** for a global HTTP-based application on EC2 instances in multiple Regions.
  * **Protect the application** against common web exploits
  * Ensure **static IP addresses** are available for clients.
1. A. Put the EC2 instances behind Network Load Balancers (NLBs) in each Region. Deploy AWS WAF on the NLBs. Create an accelerator using AWS Global Accelerator and register the NLBs as endpoints
   * *NLBs with Static IPs*: NLBs provide static IP addresses (and can have EIPs associated), which meets the static IP requirement
   * *Global Accelerator*: AWS Global Accelerator uses the AWS global network to route traffic to the optimal endpoint (NLBs in this case), significantly improving global performance and availability. It also provides static Anycast IP addresses at the edge, which can be shared with clients.
   * *AWS WAF on NLBs*: This is the problematic part. AWS WAF does not natively integrate directly with Network Load Balancers. WAF operates at Layer 7 (HTTP/HTTPS), while NLBs operate at Layer 4 (TCP/UDP). **To use WAF with an NLB, you typically need to put an ALB behind the NLB and apply WAF to the ALB**. So, this option fails the WAF requirement directly on the NLB.
2. B. Put the EC2 instances behind Application Load Balancers (ALBs) in each Region. Deploy AWS WAF on the ALBs. Create an accelerator using AWS Global Accelerator and register the ALBs as endpoints.
   * *ALBs for HTTP and WAF*: ALBs are ideal for HTTP-based applications and integrate natively with AWS WAF for protection against web exploits. This meets the HTTP and WAF requirements.
   * *Global Accelerator for Static IPs and Global Performance*: AWS Global Accelerator can provide static Anycast IP addresses at the edge. You can register ALBs as endpoints to Global Accelerator. Global Accelerator routes traffic over the AWS backbone to the closest healthy ALB, improving global performance and availability. This successfully addresses the static IP requirement by placing Global Accelerator in front of the ALBs. This looks like a strong solution.
3. C. Put the EC2 instances behind Network Load Balancers (NLBs) in each Region. Deploy AWS WAF on the NLBs. Create an Amazon CloudFront distribution with an origin that uses Amazon Route 53 latency-based routing to route requests to the NLBs.
   * *NLBs for Static IPs*: As in A, NLBs provide static IPs
   * *AWS WAF on NLBs*: Again, WAF does not directly integrate with NLBs, making this part incorrect.
   * *CloudFront with Route 53*: CloudFront is a CDN for caching and accelerating content delivery, mainly for web content. While it can improve performance, it's generally best for cacheable content. For dynamic applications, Global Accelerator often provides better end-to-end performance routing over the AWS network. More importantly, **CloudFront itself doesn't offer static ingress IPs that clients can whitelist**.
4. D. Put the EC2 instances behind Application Load Balancers (ALBs) in each Region. Create an Amazon CloudFront distribution with an origin that uses Amazon Route 53 latency-based routing to route requests to the ALBs. Deploy AWS WAF on the CloudFront distribution.
   * *ALBs for HTTP*: ALBs are suitable for HTTP applications.
   * *CloudFront for Performance and WAF*: CloudFront can improve performance (especially for cacheable content) and integrates with AWS WAF for protection.
   * *Route 53 Latency-Based Routing*: This helps direct users to the closest DNS resolver, which then points to the CloudFront distribution.
   * *Static IP Addresses*: The crucial missing piece here is the static IP requirement for clients. **CloudFront's edge locations use a dynamically changing set of IP addresses.** While the CloudFront distribution URL remains constant, the underlying IPs that clients resolve can change, which is problematic for clients with strict IP whitelisting. This option does not meet the static IP requirement.

## Thinking
* 因為題目講到需要提升 Application 的 performance 和 availability，所以基本上是用 Application Load Balancer (ALB)，因此先排除Option A 和 Option C
* 然後CloudFront 基本上是處理/分發 static content (Content Delivery Network)，所以其實不太符合題目 application 的需求